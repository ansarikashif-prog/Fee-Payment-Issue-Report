<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Report 3rd Year Fee Payment Issue | JMI CDOE</title>
<style>
  :root{
    --accent:#1a73e8;
    --muted:#666;
    --card-bg:#fff;
    --page-bg1:#e3f2fd;
    --page-bg2:#f1f8e9;
    --preview-bg:#fafafa;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
    background:linear-gradient(90deg,var(--page-bg1),var(--page-bg2));
    display:flex;align-items:center;justify-content:center;
    min-height:100vh;padding:24px;
  }
  .card{
    width:100%;max-width:760px;background:var(--card-bg);
    border-radius:12px;padding:28px;
    box-shadow:0 8px 28px rgba(14,30,37,0.12);
    color:#222;
  }
  h1{text-align:center;color:#0b3a91;font-size:1.6rem;margin:0 0 18px}
  label{display:block;margin-bottom:6px;font-weight:600;font-size:.95rem}
  input[type=text]{
    width:100%;padding:12px 14px;border-radius:8px;
    border:1px solid #d0d7de;font-size:15px;
    transition:border .15s,box-shadow .15s;
  }
  input[type=text]:focus{border-color:var(--accent);outline:none;
    box-shadow:0 0 0 4px rgba(26,115,232,.08)}
  .preview-wrap{position:relative;margin-top:18px}
  .preview{
    width:100%;min-height:180px;padding:18px;border-radius:10px;
    background:var(--preview-bg);border:1px solid #e3e7ea;
    font-size:15px;line-height:1.55;white-space:pre-wrap;overflow:auto;
  }
  .rewrite-btn{
    position:absolute;right:12px;bottom:12px;
    background:#fff;border:1px solid #d6d6d6;border-radius:8px;
    padding:6px 10px;font-size:14px;cursor:pointer;
    box-shadow:0 4px 10px rgba(12,24,40,.08);
  }
  .rewrite-btn:hover{background:#f5f6f7}
  .actions{display:flex;justify-content:center;margin-top:18px}
  .send-btn{
    background:var(--accent);color:#fff;border:none;
    padding:12px 28px;border-radius:10px;font-size:16px;
    cursor:pointer;box-shadow:0 8px 18px rgba(26,115,232,.18);
  }
  .send-btn:disabled{opacity:.6;cursor:default}
  .note{text-align:center;color:var(--muted);font-size:13px;margin-top:14px}
  .status{text-align:center;margin-top:10px;font-size:14px}
  @media(max-width:520px){.send-btn{width:100%}}
</style>
</head>
<body>

<div class="card">
  <h1>Report: 3rd Year Fee Payment Portal Issue</h1>

  <label for="name">Your Name *</label>
  <input id="name" type="text" placeholder="e.g. Zaid" />

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
    <div>
      <label for="rollNo">Roll Number *</label>
      <input id="rollNo" type="text" placeholder="e.g. D23BA0000" />
    </div>
    <div>
      <label for="enrollNo">Enrollment Number *</label>
      <input id="enrollNo" type="text" placeholder="e.g. 12-3456" />
    </div>
  </div>

  <div class="preview-wrap">
    <div id="preview" class="preview" contenteditable="true">
      Please enter Name, Roll No and Enrollment No to see the auto-generated email preview.
    </div>
    <button id="rewriteBtn" class="rewrite-btn" title="Get a different version">↻ Rewrite</button>
  </div>

  <div class="actions">
    <button id="sendBtn" class="send-btn">Send My Concern</button>
  </div>

  <div id="statusMsg" class="status"></div>
  <div class="note">Preview auto-fills as you type. You can edit before sending.</div>
</div>

<!-- Firebase (ES Modules latest) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, addDoc, collection, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCt0mvu4CbRQBdBJL5wAxijAdEirBUDCDc",
    authDomain: "justice-for-jmi.firebaseapp.com",
    projectId: "justice-for-jmi",
    storageBucket: "justice-for-jmi.appspot.com",
    messagingSenderId: "17849710989",
    appId: "1:17849710989:web:0b1dd3c9bb77520d98a5c4"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ---------- Templates ----------
  const templates = [
`Respected Dr. Sheikh Moinuddin Sir,

My name is [NAME], Roll No: [ROLL], Enrollment No: [ENROLL]. I am a student of B.A. (3rd Year) ODL, 2023 batch.

While attempting to submit my 3rd-year fee on the online portal, I received the message: "Last date of fee submission is over." The original deadline was 25 October 2025. Despite your kind announcement extending the deadline, the portal still prevents payment.

I would be grateful if you could kindly have the portal updated so I can complete my payment without further difficulty.

Sincerely,
[NAME]`,
`Respected Dr. Sheikh Moinuddin Sir,

This is [NAME], Roll No: [ROLL], Enrollment No: [ENROLL], B.A. (3rd Year) ODL, 2023 batch.

Each time I try to pay my 3rd-year fee the portal shows "Last date of fee submission is over." The previously given last date was 25 October 2025, and after the extension announcement the site should have been updated.

I respectfully request your assistance in resolving this technical issue at the earliest.

With thanks,
[NAME]`,
`Respected Dr. Sheikh Moinuddin Sir,

My name is [NAME] (Roll No: [ROLL], Enrollment No: [ENROLL]). I am enrolled in B.A. (3rd Year) ODL, 2023 batch.

When I proceed to pay my third-year fees, an error appears saying "Last date of fee submission is over." Since you announced an extension beyond 25 October 2025, I believe the portal needs to be updated.

Please guide or assist so I can submit the fee on time.

Regards,
[NAME]`
  ];

  // ---------- State ----------
  let currentTemplate = 0;
  let userEdited = false;

  // ---------- DOM ----------
  const nameEl = document.getElementById("name");
  const rollEl = document.getElementById("rollNo");
  const enrollEl = document.getElementById("enrollNo");
  const preview = document.getElementById("preview");
  const rewriteBtn = document.getElementById("rewriteBtn");
  const sendBtn = document.getElementById("sendBtn");
  const statusMsg = document.getElementById("statusMsg");

  // ---------- Helpers ----------
  const pickTemplate = ()=> Math.floor(Math.random()*templates.length);
  const fill = (t,n,r,e)=>t.replaceAll("[NAME]",n).replaceAll("[ROLL]",r).replaceAll("[ENROLL]",e);

  function showPreview(){
    const n=nameEl.value.trim(), r=rollEl.value.trim(), e=enrollEl.value.trim();
    if(!n||!r||!e){ if(!userEdited) preview.textContent="Please enter Name, Roll No and Enrollment No."; return; }
    if(userEdited) return;
    currentTemplate=pickTemplate();
    preview.textContent=fill(templates[currentTemplate],n,r,e);
  }

  async function saveAndSend(){
    const n=nameEl.value.trim(), r=rollEl.value.trim(), e=enrollEl.value.trim();
    if(!n||!r||!e){alert("Please fill all fields.");return;}
    const body=preview.textContent.trim()||fill(templates[currentTemplate],n,r,e);
    sendBtn.disabled=true; statusMsg.textContent="Saving...";

    try{
      await addDoc(collection(db,"submissions"),{
  name: n,
  roll: r,
  enrollment: e,
  templateIndex: currentTemplate,
  mailBody: body,
  timestamp: serverTimestamp(), // accurate server UTC time
  readableTime: new Date().toLocaleString("en-IN", { timeZone: "Asia/Kolkata" }) // readable local time
});

      statusMsg.textContent="Saved. Opening Gmail...";
      const subject=encodeURIComponent("Portal Showing 'Last Date Over' Error – 3rd Year Fee Submission");
      const gmail=`https://mail.google.com/mail/?view=cm&fs=1&to=c.smoinuddin@jmi.ac.in&su=${subject}&body=${encodeURIComponent(body)}`;
      window.open(gmail,"_blank");
      statusMsg.textContent="Mail compose opened. Please review and press Send in Gmail.";
    }catch(err){
      console.error(err);
      statusMsg.textContent="Error saving. Please try again.";
      alert("Error saving your entry. Please retry later.");
    }finally{sendBtn.disabled=false;}
  }

  // ---------- Events ----------
  [nameEl,rollEl,enrollEl].forEach(el=>{
    el.addEventListener("input",showPreview);
    el.addEventListener("paste",()=>setTimeout(showPreview,20));
  });
  preview.addEventListener("input",()=>userEdited=true);
  rewriteBtn.addEventListener("click",()=>{
    const n=nameEl.value.trim(), r=rollEl.value.trim(), e=enrollEl.value.trim();
    if(!n||!r||!e){alert("Fill all fields first.");return;}
    let i=pickTemplate(); if(i===currentTemplate) i=(i+1)%templates.length;
    currentTemplate=i; preview.textContent=fill(templates[i],n,r,e); userEdited=false;
  });
  sendBtn.addEventListener("click",saveAndSend);
  nameEl.focus();
</script>
</body>
</html>
